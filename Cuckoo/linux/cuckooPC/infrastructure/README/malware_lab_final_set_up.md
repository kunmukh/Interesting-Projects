# Malware Lab set to run samples

# 1> VM creation

* clone of a pre-existing cuckoo client machine e.g. "cuckooC2"

* change client static IP e.g. 10.0.3.102: https://graspingtech.com/ubuntu-server-16-04-static-ip/

```
auto enp0s3
iface enp0s3 inet static
address 10.0.3.102
netmask 255.255.255.0
gateway 10.0.3.1
dns-nameservers 10.0.2.53
```

* restart and curl 10.0.3.102:8000 to check the cuckoo agent is running
  
    * if agent **NOT** running, edit the crontab `sudo crontab -e` and rerun `/home/cuckooc1/agentc2/agent.sh`
    * `curl 10.0.3.102:8000` on **BOTH** host and guest OS
    * should get a reply

``` shell
{"message": "Cuckoo Agent!", "version": "0.10", "features": ["execpy", "pinning", "logs", "largefile", "unicodepath"]}
```

* take snapshot **(while the VM is running)** e.g. "cuckooC2s"

``` shell
VBoxManage snapshot "cuckooC2" take "cuckooC2s" --pause
VBoxManage controlvm "cuckooC2" poweroff
VBoxManage snapshot "cuckooC2" restorecurrent
```

* update $CUCKOO_HOME/conf/virtualbox.conf

``` shell
machines = cuckoo1, cuckoo2,

[cuckoo2]
label = cuckooC2
platform = linux
ip = 10.0.3.102
snapshot = cuckooC2s
resultserver_ip = 10.0.3.1
tags = 64_bit
```

# 2> change storage of memory dump from local machine to HDD

* create a soft link

```
ln -s /media/cuckoo/Volume-2/cuckoo-Analysis/analyses $CUCKOO_HOME/storage/analyses/
```

# 3> disable Memory Dump

* change the config files

```
nano $CUCKOO_HOME/conf/cuckoo.conf

memory_dump = no
process_results = no

nano $CUCKOO_HOME/conf/processing.conf

[memory]
enabled = no
```
* disable dump creation and processing when starting the analysis in the GUI

# 4> disable Network Dump

```
nano $CUCKOO_HOME/conf/auxiliary.conf

[sniffer]
enabled = no
```